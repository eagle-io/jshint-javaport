language: java
jdk: oraclejdk8

# Encrypted global secret variables (passwords and keys)
env:
  global:
    - secure: dH6yhuE+U8wKJbfRk51CJ6tG+j5PVllx6OHD4rXPb9jKVw/H3AiDsUnWnnBJCkL2mgSMeSDmOlS298kqKXPl7QHRWbx50dZebcEm8k5KLvkB4eW/wozZ9VaZG4ZUpAvV1v7dYpcQi2kPxIkxpZMpA1kPT12ukrLKIFbVD3W+1FvVEWCcbXRduhBF4dklwL5G70XkwM8DNIkAhsynAgellbedlcf9ScBNWpnBBKHLXJaHNxfrPyB4GQEvplhrr03L0zqDIFih56YJJjUuJ6N+V3i0gTIexmKdrBp4VTJzYNZE8GJad9zbSTdoYqF8r9mqWhWs5tmz17juWLyb3Ludl1Syb1UKOwDM0LmmLSeK1MaDlnv8eoKODGiZD8Of1k77rvEL7066PdMsPbxCF1xWm25hdrNERhB1WYxprbZtS5uqc6yRedGPUDxRW2WfOv1ns3FvaP+GBRmG9Qq2hUldVlbJXSSprC8wX/FUokeEO4Mg76JNnOv9F/HMWy7rT9dOPZBWyvpdF1pP2d1nrrmOCj9aYf27MldoqecRBShjQmn6nldJx7DsCvg69rt23pU1uPXIoGK18fEZwBUOn8PFhu2aCA/K4YlH3G6oD0cj7WYGPl1oFoTMZBoPgxC7+kVV2ehN4ZS7To6vRZsh6WJ49eTW/BmFKuyBc+dUBr2N5m8=
    - secure: ELb3Tk8xR46btnFHA7b54PL7MgDLr9+xEN0wLA1qU4j6na0waeR1rRYqLJt9A3eYp4Wm3krfMFvxqiqbfIQLCWj4DfcCX2UaKFewKNyq6IbHyfKJ/8i8mO/BEJJM7mLTwudsTb6eDDsAkxOX34triDSHzOvg/+X04+mN4fSMgh8uruXaWT25jvHo2XpZ3Wjx0Lq4oIwEAR6kyMqdcE+j8zJFyEVvuzcLwrRoCNRuqq4hjVkqqwLEt/9tSA9+ziO8mWAX7Y/TJamavp22kgp2BG/N5khOV/n3r8y0oUwbvrmgSCOGrzfwty7JockuxxTZeWB1yJfvPnQmqoU49h0cDsaiK0WLjxCCwdK+7zhtKCK6NnEW8L2m6WPKPaaiHCE91ZyTzlYtznzPsk2qSWft+eV+VtGrLhWEtoHsMzBbiu3x3j4ceYd7zXvxl5hJEQ4xBamZnKmz/B7MM/KFHRjrn9CJAqLbkfpC4IYcijm4J/KVxr7rwE9rpWxneMVvZDz9Rh4i8ssMWP22F5lRHi6Ygc/J2SCSNAQylvf+T1ue+UGPmUugiNi5qvkwfH6c30mTs5trOPLO+3UYoVsS9Ph3JC2aE69/3KI1KUzdlP7DnjX3JDAPHEJKc64u4Epd5acoOa7+xjOhWYDBhyzbjIr4hXa4hmlbX1Z/ywpLLeDzgk0=
    - secure: Tx5XLj3O0fDcZaWwMiKeNCG/gq2cOZD6/n2Vd9zNLirZEhBtraEGnXY/JjrHOWIiPZK2UcMWWVZZ1G/gxPGV3oJFHnt77v31SRxuqkilXIiziP/uHxrVOhW2ZzLUneuN0V1Sj/1dPezU2XcirpVQZrG7N4pCJs88NqT/a3N6drgPaYBgxw9FLULRdUI7NWhloPLOOXz9s7GCSSVIxD6CivRjLp8r6n0enEpNjoCXQFnaDzl1g2qhRhV4y0IfKi2owdSFS3wThAgJ6v25Eo/x6LdImselLLZ4UAetCWAfb/cKaLrlIXE385rPkdKqiSSW1NvOphGEOOOPAW5Nc92d8DdOOAm2hPlMcH0+9y6Y2NAk8QUCeAVpPxfVdqHo2pQgP9HDNhfhvaoPkX565RhD8wByyLmv6oQI4OCD4JhSjecY5xnuOkkzRvz4xwG/ArdmXGrDuDilD9BHo3HY2FOyxH2Ds/yK4UQo/yNaZIb99qHy48SsHGTstX+76nK0xerzJBGOdbg4LvkZIllh2UmscfufS6dhg4d0iE4Cnk/Vv+BPqnll/N9axaQ61Ab/VEUQYI3+d0qBND3Tp47CibeLOeU7LrMgc0zrAATEG/DQaHKKVWuHyVj9DxX1IV0r1LCpBPoIgZnN/6czfMs8XtuVPFaCe5RpGKmEzoGctdxQqYs=
  
# Build settings
sudo: false
addons:
  apt:
    packages:
      - oracle-java8-installer
notifications:
  email: false

# Execute custom script instead of default travis execution
script:
  - ./gradlew --rerun-tasks test jacocoTestReport coveralls -x classes
branches:
  only:
  - develop
  - master
  
# Output all test results in case of the build failure
after_failure:
  - cat build/test-results/test/*.xml

# Deploy snapshot version or release version, depending on the branch (that is decided in gradle, see deployment.gradle)
# TODO if deployment failed do something and add task to redeploy package if it was successfully compiled and tested 
deploy:
  provider: script
  script: ./gradlew travisDeploy
  skip_cleanup: true
  on:
    all_branches: true
    jdk: oraclejdk8

# Used to avoid uploading the cache after every build, see https://docs.travis-ci.com/user/languages/java/#Caching
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.m2/repositories/